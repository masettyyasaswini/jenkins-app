!function(){"use strict";angular.module("appointlet.scheduler",["appointlet.querystring","restangular","ui.router","angularMoment","LocalStorageModule","angularLoad","ui.bootstrap.datepicker","truncate","popup","angular-ladda","Showdown","google.places"]).config(["RestangularProvider","settings",function(e,t){e.setBaseUrl(t.API_URL)}]).config(["MixpanelProvider","settings",function(e,t){e.init(t.MIXPANEL_TOKEN)}]).config(["datepickerConfig","datepickerPopupConfig",function(e,t){e.showWeeks=!1,e.startingDay=1,t.showButtonBar=!1,t.appendToBody=!0}]).config(["$ShowdownProvider",function(e){e.loadExtension(function(){return[{type:"output",regex:'<a href="(.+)">(.+)</a>',replace:'<a href="$1" target="_blank">$2</a>'}]})}]).run(["Locale","settings",function(e,t){e.set(t.LOCALE)}]).config(["$locationProvider","$urlRouterProvider",function(e,t){e.html5Mode(!0),t.otherwise(function(e){e.get("$state").go("404")})}]).run(["Parent","$rootScope",function(e,t){e.loaded(),t.parent=e}]).run(["$rootScope","$state","$log","$window","Mixpanel",function(e,a,c,l,s){e.state=a,e.setTitle=function(){e.titleParts=Array.prototype.slice.call(arguments)},e.$on("$stateChangeSuccess",function(e,t,n,o){c.debug("$stateChangeSuccess:",o.name||"n/a","->",t.name),l.scrollTo(0,0)}),e.$on("$stateChangeError",function(e,t,n,o,i,r){c.debug("$stateChangeError:",r),a.go("404",{},{location:!1}),s.trackEvent("State Change Error",{Error:r,Path:l.location.pathname})})}])}(),function(){"use strict";angular.module("appointlet.scheduler").directive("addToCalendar",function(){return{restrict:"E",scope:{booking:"="},templateUrl:"src/directives/add-to-calendar.html"}})}(),angular.module("google.places",[]).factory("googlePlacesApi",["$window",function(e){if(e.google)return e.google;throw"Global `google` var missing. Did you forget to include the places API script?"}]).directive("gPlacesAutocomplete",["$parse","$compile","$timeout","$document","googlePlacesApi",function(e,_,$,y,w){return{restrict:"A",require:"^ngModel",scope:{model:"=ngModel",options:"=?",forceSelection:"=?",customPlaces:"=?"},controller:["$scope",function(e){}],link:function(r,e,t,n){var o,i,a={tab:9,enter:13,esc:27,up:38,down:40},c=[a.tab,a.enter,a.esc,a.up,a.down],l=new w.maps.places.AutocompleteService,s=new w.maps.places.PlacesService(e[0]);function u(e){0!==r.predictions.length&&-1!==function(e,t){var n,o;if(null!=e)for(o=e.length,n=0;n<o;n++)if(e[n]===t)return n;return-1}(c,e.which)&&(e.preventDefault(),e.which===a.down?(r.active=(r.active+1)%r.predictions.length,r.$digest()):e.which===a.up?(r.active=(r.active||r.predictions.length)-1,r.$digest()):13===e.which||9===e.which?(r.forceSelection&&(r.active=-1===r.active?0:r.active),r.$apply(function(){r.selected=r.active,-1===r.selected&&h()})):27===e.which&&r.$apply(function(){e.stopPropagation(),h()}))}function d(e){0!==r.predictions.length&&(r.forceSelection&&(r.selected=-1===r.selected?0:r.selected),r.$digest(),r.$apply(function(){-1===r.selected&&h()}))}function p(){var e=r.predictions[r.selected];e&&(e.is_custom?r.$apply(function(){r.model=e.place,r.$emit("g-places-autocomplete:select",e.place),$(function(){n.$viewChangeListeners.forEach(function(e){e()})})}):s.getDetails({placeId:e.place_id,fields:["formatted_address"]},function(e,t){t==w.maps.places.PlacesServiceStatus.OK&&r.$apply(function(){r.model=e.formatted_address,r.$emit("g-places-autocomplete:select",e),$(function(){n.$viewChangeListeners.forEach(function(e){e()})})})}),h())}function g(e){var t;return e&&b(e)&&(r.query=e,t=angular.extend({input:e},r.options),l.getPlacePredictions(t,function(t,n){r.$apply(function(){var e;h(),r.customPlaces&&(e=function(e){var t,n,o,i=[];for(o=0;o<r.customPlaces.length;o++)t=r.customPlaces[o],0<(n=function(e,t){var n,o,i,r=e+"",a=[],c=[];for(o=t.formatted_address.split(","),i=0;i<o.length;i++)n=o[i].trim(),0<r.length&&(r=n.length>=r.length?(v(n,r)&&c.push({length:r.length,offset:i}),""):v(r,n)?(c.push({length:n.length,offset:i}),r.replace(n,"").trim()):""),a.push({value:n,offset:t.formatted_address.indexOf(n)});return{matched_substrings:c,terms:a}}(e,t)).matched_substrings.length&&i.push({is_custom:!0,custom_prediction_label:t.custom_prediction_label||"(Custom Non-Google Result)",description:t.formatted_address,place:t,matched_substrings:n.matched_substrings,terms:n.terms});return i}(r.query),r.predictions.push.apply(r.predictions,e)),n==w.maps.places.PlacesServiceStatus.OK&&r.predictions.push.apply(r.predictions,t),5<r.predictions.length&&(r.predictions.length=5)})}),r.forceSelection)?n.$modelValue:e}function m(e){var t="";return b(e)?t=e:"[object Object]"==Object.prototype.toString.call(e)&&(t=e.formatted_address),t}function f(){return e.val(n.$viewValue)}function h(){r.active=-1,r.selected=-1,r.predictions=[]}function b(e){return"[object String]"==Object.prototype.toString.call(e)}function v(e,t){return 0===k(e).lastIndexOf(k(t),0)}function k(e){return null==e?"":e.toLowerCase()}r.query="",r.predictions=[],r.input=e,r.options=r.options||{},o=angular.element("<div g-places-autocomplete-drawer></div>"),i=angular.element(y[0].body),o.attr({input:"input",query:"query",predictions:"predictions",active:"active",selected:"selected"}),o=_(o)(r),i.append(o),e.bind("keydown",u),e.bind("blur",d),e.bind("submit",d),r.$watch("selected",p),n.$parsers.push(g),n.$formatters.push(m),n.$render=f}}}]).directive("gPlacesAutocompleteDrawer",["$window","$document",function(i,r){return{restrict:"A",scope:{input:"=",query:"=",predictions:"=",active:"=",selected:"="},template:['<div class="pac-container" ng-if="isOpen()" ng-style="{top: position.top+\'px\', left: position.left+\'px\', width: position.width+\'px\'}" style="display: block;" role="listbox" aria-hidden="{{!isOpen()}}">','  <div class="pac-item" g-places-autocomplete-prediction index="$index" prediction="prediction" query="query"','       ng-repeat="prediction in predictions track by $index" ng-class="{\'pac-item-selected\': isActive($index) }"','       ng-mouseenter="selectActive($index)" ng-click="selectPrediction($index)" role="option" id="{{prediction.id}}">',"  </div>","</div>"].join(""),link:function(t,e){function n(e){var e=e[0].getBoundingClientRect(),t=r[0].documentElement,n=r[0].body,o=i.pageYOffset||t.scrollTop||n.scrollTop,t=i.pageXOffset||t.scrollLeft||n.scrollLeft;return{width:e.width,height:e.height,top:e.top+e.height+o,left:e.left+t}}e.bind("mousedown",function(e){e.preventDefault()}),i.onresize=function(){t.$apply(function(){t.position=n(t.input)})},t.isOpen=function(){return 0<t.predictions.length},t.isActive=function(e){return t.active===e},t.selectActive=function(e){t.active=e},t.selectPrediction=function(e){t.selected=e},t.$watch("predictions",function(){t.position=n(t.input)},!0)}}}]).directive("gPlacesAutocompletePrediction",[function(){return{restrict:"A",scope:{index:"=",prediction:"=",query:"="},template:['<span class="pac-icon pac-icon-marker"></span>','<span class="pac-item-query" ng-bind-html="prediction | highlightMatched"></span>','<span ng-repeat="term in prediction.terms | unmatchedTermsOnly:prediction">{{term.value | trailingComma:!$last}}&nbsp;</span>','<span class="custom-prediction-label" ng-if="prediction.is_custom">&nbsp;{{prediction.custom_prediction_label}}</span>'].join("")}}]).filter("highlightMatched",["$sce",function(i){return function(e){var t,n="",o="";return 0<e.matched_substrings.length&&0<e.terms.length&&(t=e.matched_substrings[0],n=e.terms[0].value.substr(t.offset,t.length),o=e.terms[0].value.substr(t.offset+t.length)),i.trustAsHtml('<span class="pac-matched">'+n+"</span>"+o)}}]).filter("unmatchedTermsOnly",[function(){return function(e,t){for(var n,o=[],i=0;i<e.length;i++)n=e[i],0<t.matched_substrings.length&&n.offset>t.matched_substrings[0].length&&o.push(n);return o}}]).filter("trailingComma",[function(){return function(e,t){return t?e+",":e}}]),function(){"use strict";angular.module("appointlet.scheduler").directive("bookableButton",function(){return{restrict:"E",scope:{bookable:"=model",active:"="},templateUrl:"src/directives/bookable-button.html"}})}(),function(){"use strict";angular.module("appointlet.scheduler").directive("bookablePanel",function(){return{restrict:"E",transclude:!0,scope:{bookable:"=model",compact:"=compact"},templateUrl:"src/directives/bookable-panel.html",link:function(t){t.moreLength=125,t.more=!1,t.showMore=function(e){e.stopPropagation(),t.more=!0}}}})}(),function(){"use strict";angular.module("appointlet.scheduler").directive("bookableSection",function(){return{restrict:"E",transclude:!0,replace:!0,scope:{booking:"="},templateUrl:"src/directives/bookable-section.html"}})}(),function(){"use strict";angular.module("appointlet.scheduler").directive("checklist",function(){return{restrict:"A",require:"ngModel",scope:{value:"=checklist"},link:function(t,e,n,o){o.$formatters.unshift(function(){return o.$modelValue}),o.$parsers.push(function(e){return e?_.union(o.$modelValue,[t.value]):_.without(o.$modelValue,t.value)}),o.$render=function(){e[0].checked=0<=_.indexOf(o.$modelValue,t.value)},o.$isEmpty=function(){return!angular.isArray(o.$$rawModelValue)||!o.$$rawModelValue.length}}}})}(),function(){"use strict";angular.module("appointlet.scheduler").directive("clientSection",function(){return{restrict:"E",replace:!0,scope:{booking:"="},templateUrl:"src/directives/client-section.html"}})}(),function(){"use strict";angular.module("appointlet.scheduler").directive("loader",function(){return{restrict:"E",transclude:!0,templateUrl:"src/directives/loader.html"}})}(),function(){"use strict";angular.module("appointlet.scheduler").directive("locationSection",function(){return{restrict:"E",transclude:!0,replace:!0,scope:{booking:"="},templateUrl:"src/directives/location-section.html"}})}(),function(){"use strict";angular.module("appointlet.scheduler").directive("now",["$interval","moment",function(i,r){return{restrict:"E",scope:{format:"@",timezone:"="},link:function(e,t){function n(){t.html(r.tz(e.timezone).format(e.format))}e.$on("timezone:changed",n);var o=i(n,1e3,0,!1);e.$on("$destroy",function(){i.cancel(o)}),n()}}}])}(),function(){"use strict";angular.module("appointlet.scheduler").directive("paymentButton",function(){return{restrict:"E",scope:{account:"=model"},templateUrl:"src/directives/payment-button.html"}})}(),function(){"use strict";angular.module("appointlet.scheduler").directive("prettyFieldValue",function(){return{restrict:"E",scope:{field:"=",value:"="},templateUrl:"src/directives/pretty-field-value.html"}})}(),function(){"use strict";angular.module("appointlet.scheduler").directive("serviceButton",function(){return{restrict:"E",scope:{service:"=model",active:"="},templateUrl:"src/directives/service-button.html"}})}(),function(){"use strict";angular.module("appointlet.scheduler").directive("servicePanel",function(){return{restrict:"E",transclude:!0,scope:{service:"=model",compact:"=compact"},templateUrl:"src/directives/service-panel.html",link:function(t){t.moreLength=125,t.more=!1,t.showMore=function(e){e.stopPropagation(),t.more=!0}}}}).filter("price",function(){return function(e,t){return-1!==_.indexOf(["USD","CLP"],t)?"$"+e:e+" "+t}})}(),function(){"use strict";angular.module("appointlet.scheduler").directive("serviceSection",function(){return{restrict:"E",transclude:!0,replace:!0,scope:{booking:"="},templateUrl:"src/directives/service-section.html"}})}(),function(){"use strict";angular.module("appointlet.scheduler").directive("staticSrc",["settings",function(o){return{restrict:"A",link:function(e,t,n){t.attr("src",o.STATIC_URL.replace("{src}",n.staticSrc))}}}])}(),function(){"use strict";angular.module("appointlet.scheduler").directive("timePicker",["$q","$log","TimePickerCache","moment",function(i,l,r,o){function a(e,t){var n=e[e.length-1];return n&&t.startUnix===n.startUnix?n.bookables.push(t.bookables[0]):e.push(t),e}var s=function(e){var t=[];return e.push(t),t};return{restrict:"E",require:"ngModel",replace:!0,scope:{bookables:"=",service:"=",pageSize:"=?",timezone:"=",maxTimesPerDay:"=",onlyTimesBefore:"@?",onlyTimesAfter:"@?"},templateUrl:"src/directives/time-picker.html",controller:["$scope",function(n){n.offset=0,n.nextPage=function(){n.hasNextPage()&&n.offset++},n.prevPage=function(){n.hasPrevPage()&&n.offset--},n.hasNextPage=function(){return 0<=n.offset&&n.offset<n.pages.length-1},n.hasPrevPage=function(){return 0<n.offset},n.setPageByDate=function(e){n.offset=_.indexOf(n.pages,n.pageForDate(e))},n.pageForDate=function(e){var t=o(e).tz(n.timezone).format("YYYYMMDD");return _.find(n.pages,function(e){return _.find(e,function(e){return e[0].start.clone().tz(n.timezone).format("YYYYMMDD")===t})})}}],link:function(c,e,t,n){function o(){var t,n,o,r,a,i,e=_.chain(c.times),e=((c.onlyTimesBefore||c.onlyTimesAfter)&&(l.debug("timePicker","onlyTimesAfter",c.onlyTimesAfter),l.debug("timePicker","onlyTimesBefore",c.onlyTimesBefore),e=e.filter((t=c.timezone,n=c.onlyTimesAfter,o=c.onlyTimesBefore,function(e){e=+e.start.clone().tz(t).format("HHmm");return(!n||n<=e)&&(!o||e<=o)}))),e.reduce((r=c.timezone,a=c.pageSize,function(e,t){var n=t.start.clone().tz(r).format("YYYYMMDD"),o=e[e.length-1],i=(o=o||s(e))[o.length-1];return i&&i[0].start.clone().tz(r).format("YYYYMMDD")===n||(o.length>=a&&(o=s(e)),i=s(o)),i.push(t),e}),[]));c.maxTimesPerDay&&(e=e.map((i=c.maxTimesPerDay,function(e){return _.map(e,function(e){var t=e.slice(0);return _.times(t.length-i,function(){t.splice(_.random(0,t.length-1),1)}),t})}))),c.pages=e.value()}c.times=[],c.pages=[],c.controlData={},c.pageSize=c.pageSize||(575<=(e=e[0].offsetWidth)?6:400<=e?4:3);c.$watch("timezone",function(e){e&&o()}),c.$watch("pages",function(e){c.pageOptions=_.map(e,function(e,t){t=[t,e[0][0].start.clone().tz(c.timezone).format("ll")];return 1<e.length&&(t[1]+=" - "+e[e.length-1][0].start.clone().tz(c.timezone).format("ll")),t})}),c.$watch("controlData.jumpToDate",function(e){e&&(l.debug("timePicker","jumpToDate",e),c.setPageByDate(e)),c.controlData.jumpToDate=null}),c.loading=!0,i.when(c.bookables).then(function(e){return i.all(_.map(e,function(n){return l.debug("timePicker","loading",n.name),i(function(t){r.get(n,c.service).then(function(e){t(_.map(e,function(e){return{start:e.start,end:e.end,startUnix:e.startUnix,bookables:[n]}}))}).catch(function(){t([])})})}))}).then(function(e){var t=_.chain(e).flatten(!0);1<e.length&&(t=t.sortBy("startUnix").reduce(a,[])),c.times=t.value(),l.debug("timePicker","loaded",c.times.length,"times"),c.timezone&&o()}).finally(function(){c.loading=!1}),c.select=function(e){l.debug("timePicker","chose",e.start.format(),"->",e.end.format()),n.$setViewValue(e)},c.isSelected=function(e){return n.$modelValue&&n.$modelValue.startUnix===e.startUnix}}}}]).filter("stripYear",["settings",function(e){var t="sv"===e.LOCALE.substr(0,2);return function(e){e=e.replace(/[^\d\ ]?\d{4}[^\d\ ]?/,"");return t?e.replace(/(\w+)\ (\d{1,2})(\D)(\d{1,2})/,"$1 $4$3$2"):e}}]).service("TimePickerCache",["$log",function(o){this.cache={},this.get=function(e,t){var n=t.id+":"+e.id;return this.cache[n]||(o.debug("TimePickerCache","miss",n),this.cache[n]=e.$fetchAvailableTimes(t)),this.cache[n]},this.clear=function(){o.debug("TimePickerCache","clear"),this.cache={}}}]).run(["TimePickerCache","$rootScope",function(e,t){t.$on("booking:completed",function(){e.clear()})}])}(),function(){"use strict";angular.module("appointlet.scheduler").directive("timeSection",function(){return{restrict:"E",replace:!0,transclude:!0,scope:{booking:"="},templateUrl:"src/directives/time-section.html"}})}(),function(){"use strict";angular.module("appointlet.scheduler").directive("timezonePicker",["Geo","$log","intl",function(i,r,a){return{restrict:"E",scope:{detect:"=?"},require:"ngModel",templateUrl:"src/directives/timezone-picker.html",controller:["$scope","settings",function(e,t){e.zones=t.TIME_ZONES,e.regions=_.reduce(e.zones,function(e,t){var n=t.split("/");return 1<n.length&&(e[n[0]]||(e[n[0]]=[]),e[n[0]].push([t,n.slice(1).join("/").replace(/_/g," ")])),e},{})}],link:function(t,e,n,o){o.$render=function(){t.tz=o.$modelValue,t.tz&&(t.region=t.tz.split("/")[0])},t.regionChanged=function(e){r.debug("timezonePicker","region changed",e),t.tz=t.regions[e][0][0],t.zoneChanged(t.tz)},t.zoneChanged=function(e){r.debug("timezonePicker","zone changed",e),o.$setViewValue(e)},t.detect&&(r.debug("timezonePicker","detecting zone"),a.timezone?(t.zoneChanged(a.timezone),o.$render()):i.query().then(function(e){e.timezone&&-1!==_.indexOf(t.zones,e.timezone)&&(r.debug("timezonePicker","detected timezone",e.timezone),t.zoneChanged(e.timezone),o.$render())},function(){r.error("timezonePicker","failed to detect timezone",arguments)}))}}}])}(),function(){"use strict";angular.module("appointlet.scheduler").config(["$urlRouterProvider",function(e){e.when("","/")}])}(),function(){"use strict";angular.module("appointlet.scheduler").service("Bookables",["moment","Restangular",function(n,o){this.augment=function(e){e.$fetchAvailableTimes=function(t){return o.oneUrl("available_times",this.rel.available_times).get({service:t.id}).then(function(e){return _.map(e,function(e){e=n(e);return{start:e,end:e.clone().add(t.duration),startUnix:e.unix()}})})}}}])}(),function(){"use strict";angular.module("appointlet.scheduler").factory("BookingsFactory",["Restangular",function(e){return e.service("bookings")}]).config(["RestangularProvider",function(e){e.extendModel("bookings",function(e){return e.$paymentAmount=function(){return this.service.deposit||+this.service.price+ +this.service.tax},e.$cancel=function(e){return this.customPUT({message:e},"cancel")},e.$reschedule=function(e,t,n){return this.customPUT({start:e,end:t,message:n},"reschedule")},e}),e.addRequestInterceptor(function(e,t,n){return"bookings"===n&&"post"===t&&((e=_.clone(e)).organization=e.organization.id,e.service=e.service.id,e.bookable=e.bookable.id,delete e.time),e})}])}(),function(){"use strict";angular.module("appointlet.scheduler").service("Collection",function(){this.getObjectOrDie=function(e,t){e=_.findWhere(e,t);if(angular.isDefined(e))return e;throw"Failed to find object in collection"}})}(),function(){"use strict";angular.module("appointlet.scheduler").service("Geo",["Restangular",function(e){this.query=function(){return e.one("_/geo").get()}}])}(),function(){"use strict";angular.module("appointlet.scheduler").factory("intl",["settings",function(e){try{var t=Intl.DateTimeFormat().resolvedOptions();return{timezone:e.TIMEZONE_ALIASES[t.timeZone]||t.timeZone,locale:t.locale}}catch(e){return{timezone:null,locale:null}}}])}(),function(){"use strict";angular.module("appointlet.scheduler").service("Locale",["$log","$rootScope","moment",function(t,n,o){this.set=function(e){t.debug("Locale","set",e),o.locale(e),n.$broadcast("locale:changed",e)}}])}(),function(){"use strict";angular.module("appointlet.scheduler").service("Localize",["$window",function(e){return e.Localize||{translate:function(n,e){return _.each(e,function(e,t){n=n.replace("%{"+t+"}",e)}),n}}}])}(),function(){"use strict";angular.module("appointlet.scheduler").provider("Mixpanel",function(){this.init=angular.noop,this.$get=function(){return this.register=angular.noop,this.trackEvent=angular.noop,this.identify=angular.noop,this}})}(),function(){"use strict";function c(e){return _.isString(e)?encodeURIComponent(e):_.isArray(e)?_.map(e,c):_.isObject(e)?_.chain(e).map(function(e,t){return[t,c(e)]}).object().value():e}angular.module("appointlet.scheduler").factory("Organizations",["Restangular",function(e){return e.service("organizations")}]).service("Organization",["Organizations","Services","Bookables","PaymentAccounts","settings","$interpolate","Restangular",function(e,t,n,o,i,r,a){return e.one(i.ORGANIZATION_ID).one("scheduler").get().then(function(e){return _.each(e.services,t.augment),_.each(e.payment_accounts,o.augment),_.each(e.bookables,n.augment),e.plan?(e.$allowedServices=e.services.slice(0,-1===e.plan.services_count?e.services.length:e.plan.services_count),e.$allowedBookables=e.bookables.slice(0,e.plan.per_bookable?e.seats:-1===e.plan.bookables_count?e.bookables.length:e.plan.bookables_count),e.$allowedFields=e.fields.slice(0,-1===e.plan.fields_count?e.fields.length:e.plan.fields_count)):(e.$allowedServices=[],e.$allowedBookables=[],e.$allowedFields=[]),e.$poolInfo=_.memoize(function(e){var t={};return e&&(t.service=e),a.oneUrl("pool_info",this.rel.pool_info).get(t)}),e.$poolInfoV2=_.memoize(function(e){e={service:e};return a.oneUrl("pool_info",this.rel.pool_info+"_v2").get(e)}),e.$bookablesByService=function(t){return _.filter(this.$allowedBookables,function(e){return 0<=_.indexOf(e.services_performed,t.id)})},e.$servicesByBookable=function(t){return _.filter(this.$allowedServices,function(e){return 0<=_.indexOf(t.services_performed,e.id)})},e.$servicesPerformed=function(){return _.chain(this.$allowedBookables).pluck("services_performed").flatten().uniq().value()},e.$fieldsByService=function(t){return _.filter(this.$allowedFields,function(e){return e.all_services||0<=_.indexOf(e.services,t.id)})},e.$canPoolAvailability=function(e){return this.plan.pooled_availability&&e.pooled_availability},e.$redirectURL=function(e){e=e.plain();return e.fields=_.chain(e.fields).map(function(e){return[e.field.slug,e.value]}).object().value(),r(this.redirect_url)({booking:c(e)})},e})}])}(),function(){"use strict";angular.module("appointlet.scheduler").service("Params",["$location","QueryString",function(e,t){this.hash=t.decode(e.hash()),this.query=e.search()}])}(),function(){"use strict";angular.module("appointlet.scheduler").service("Parent",["$window","$log",function(e,n){this.modal=e.self!==e.parent,this.opener=e.opener||(e.parent===e.self?null:e.parent),this.legacyModal=this.modal&&"?legacy"===e.location.search,this.transmit=function(e,t){return!!this.opener&&(e=angular.toJson({type:e,data:t||{}}),this.legacyModal||(e="appointlet:"+e),n.debug("Parent","transmitting",e),this.opener.postMessage(e,"*"))},this.close=function(){this.transmit("scheduler:close"),this.legacyModal&&this.transmit("close")},this.loaded=function(){this.transmit("scheduler:loaded"),this.legacyModal&&this.transmit("load")},this.bookingCreated=function(e){this.transmit("booking:created",e.plain())},this.redirect=function(e){this.transmit("user:redirect",e)},this.persist=function(e){this.transmit("user:persist",e)}}])}(),function(){"use strict";angular.module("appointlet.scheduler").service("PaymentAccounts",["$http",function(t){this.augment=function(e){e.$status=function(e){return t({method:"GET",url:this.rel.status+"?identifier="+e}).then(function(e){if("completed"!==e.data.status)throw e.data;return e.data})},e.$prepare=function(e){return t({method:"POST",url:this.rel.prepare,data:angular.toJson({service:e})}).then(function(e){return e.data})},e.$prepareData={}}}])}(),function(){"use strict";angular.module("appointlet.scheduler").service("PayPalHandler",["$window","$log","PopUp","Localize",function(e,o,i,t){this.description=function(e){return t.translate("Pay %{amount} with your PayPal balance.",{amount:e.$chargeAmount+" "+e.currency})},this.prepare=function(e,t){return e.$prepare(t)},this.authorize=function(e,t,n){o.debug("PayPalHandler","authorize",e,t,n);n=i.open(t.url,"paypal",{height:525,width:375}).then(function(){return e.$status(t.paykey)}).then(function(){return t.paykey});return n.$check=function(){return e.$status(t.paykey).then(function(){return t.paykey})},n}}]).constant("PayPalIdentifier","paypal").run(["PayPalIdentifier","PaymentHandlers","PayPalHandler",function(e,t,n){t.set(e,n)}])}(),function(){"use strict";angular.module("appointlet.scheduler").service("Services",["moment",function(t){this.augment=function(e){e.duration=t.duration(e.duration,"s"),e.minimum_notice=t.duration(e.minimum_notice,"s"),e.maximum_notice=t.duration(e.maximum_notice,"s"),null!==e.cancelation_notice&&(e.cancelation_notice=t.duration(e.cancelation_notice,"s")),null!==e.reschedule_notice&&(e.reschedule_notice=t.duration(e.reschedule_notice,"s")),e.$chargeAmount=e.price?e.deposit||e.price+e.tax:0}}])}(),function(){"use strict";angular.module("appointlet.scheduler").service("SlideManager",["$log","$state",function(n,i){this.slides=[],this.isCurrent=function(e){var t=i.current.name.split(".");return t[t.length-1]===e},this.isBehind=function(e){var t=i.current.name.split("."),t=this.getByRoute(t[t.length-1]);return _.indexOf(this.slides,t)>_.indexOf(this.slides,this.getByRoute(e))},this.getByRoute=function(e){return _.findWhere(this.slides,{route:e})},this.display=function(e,t){n.debug("SlideManager","display",e,t);e=this.getByRoute(e);e&&(e.show=t)},this.remove=function(e){n.debug("SlideManager","remove",e);e=_.indexOf(this.slides,this.getByRoute(e));0<=e&&this.slides.splice(e,1)},this.getNext=function(){var e=i.current.name.split("."),o=e[e.length-1];return _.chain(this.slides).where({show:!0}).find(function(e,t,n){n=n[t-1];return n&&n.route===o}).value()},this.goNext=function(){var e=this.getNext();e&&i.go("^."+e.route,{},{location:!1})},this.getPrev=function(){var e=i.current.name.split("."),o=e[e.length-1];return _.chain(this.slides).where({show:!0}).find(function(e,t,n){n=n[t+1];return n&&n.route===o}).value()},this.goPrev=function(){var e=this.getPrev();e&&i.go("^."+e.route,{},{location:!1})},this.getFirst=function(){return _.chain(this.slides).where({show:!0}).first().value()},this.goFirst=function(){var e=this.getFirst();i.go("^."+e.route,{},{location:!1})}}])}(),function(){"use strict";angular.module("appointlet.scheduler").config(["localStorageServiceProvider",function(e){e.setPrefix("appointlet")}]).service("Storage",["$location","Parent","localStorageService",function(e,n,o){var i=o.get("data")||{};this.get=function(e){return i[e]},this.set=function(e,t){i[e]=t,o.set("data",i),n.persist({key:e,val:t})}}])}(),function(){"use strict";angular.module("appointlet.scheduler").constant("StripeCheckoutSrc","https://checkout.stripe.com/v2/checkout.js").service("StripeHandler",["$window","$log","$q","angularLoad","StripeCheckoutSrc","Localize",function(r,t,a,e,n,o){this.description=function(e){return o.translate("Pay %{amount} with your credit card.",{amount:e.$chargeAmount+" "+e.currency})},this.prepare=function(){return e.loadScript(n)},this.authorize=function(n,e,o,i){return t.debug("StripeHandler","authorize",n,e,o),a(function(t,e){r.StripeCheckout.open({key:n.config.publishable_key,locale:i.organization.language,name:i.organization.name,description:i.service.name,amount:100*o.amount,currency:o.currency,address:n.config.billing_address,email:i.email,token:function(e){t(e.id)},closed:e})})}}]).constant("StripeIdentifier","stripe").run(["StripeIdentifier","PaymentHandlers","StripeHandler",function(e,t,n){t.set(e,n)}])}(),function(){"use strict";angular.module("appointlet.scheduler").service("Timers",["SimpleTimersBackend",function(e){this.backend=e,this.timestamp=function(){return(new Date).getTime()},this.start=function(e,t){this.backend.set(e,t||this.timestamp())},this.elapsed=function(e){e=this.backend.get(e);if(e)return this.timestamp()-e},this.stop=function(e){var t=this.elapsed(e);if(t)return this.backend.remove(e),t}}]).service("SimpleTimersBackend",function(){var n={};this.set=function(e,t){n[e]=t},this.get=function(e){return n[e]},this.remove=function(e){delete n[e]}})}(),function(){"use strict";angular.module("appointlet.scheduler").service("user",["Restangular",function(e){return e.one("users","me").get()}])}(),function(){"use strict";angular.module("appointlet.scheduler").controller("NotFoundCtrl",function(){}).config(["$stateProvider",function(e){e.state("404",{templateUrl:"src/views/404/view.html",controller:"NotFoundCtrl"})}])}(),function(){"use strict";angular.module("appointlet.scheduler").controller("CompleteCtrl",["$scope",function(e){}]).config(["$stateProvider",function(t){_.each(["scheduler.create_booking.complete","scheduler.create_booking.deep_service.complete","scheduler.create_booking.deep_service.deep_bookable.complete","scheduler.create_booking.deep_bookable.complete","scheduler.create_booking.deep_bookable.deep_service.complete"],function(e){t.state(e,{templateUrl:"src/views/complete.html",controller:"CompleteCtrl"})})}])}(),function(){"use strict";angular.module("appointlet.scheduler").controller("BookablesCtrl",["$scope","$log","Mixpanel","Timers",function(t,n,o,i){t.bookables=t.organization.$bookablesByService(t.booking.service),t.organization.plan.private_bookables&&(t.bookables=_.where(t.bookables,{visible:!0})),t.select=function(e){n.debug("BookableCtrl","select",e),t.booking.bookable=e,t.slideManager.goNext(),o.trackEvent("Selected Bookable",{"Bookable ID":e.id,"Bookable Name":e.name,Elapsed:i.stop("selectBookable")})},t.isSelected=function(e){return t.booking.bookable===e},t.isValid=function(){return 0<=_.indexOf(t.bookables,t.booking.bookable)}}]).config(["$stateProvider",function(t){_.each(["scheduler.create_booking.bookables","scheduler.create_booking.deep_service.bookables"],function(e){t.state(e,{templateUrl:"src/views/create_booking/bookables/view.html",controller:"BookablesCtrl",onEnter:["Timers",function(e){e.start("selectBookable")}]})})}])}(),function(){"use strict";angular.module("appointlet.scheduler").controller("ClientCtrl",["$scope","$log","Storage","Mixpanel","Timers",function(n,e,o,t,i){n.remember=o.get("remember"),n.submit=function(){e.debug("ClientCtrl","submit",n.booking.fields),n.form.$valid&&(n.slideManager.goNext(),o.set("remember",n.remember),o.set("email",n.remember?n.booking.email:null),_.each(n.organization.fields,function(e){var t;n.remember&&e.prepopulatable&&(t=n.booking.fields[e.slug]),o.set("field__"+e.slug,t)}),t.trackEvent("Populated Form",{Elapsed:i.stop("populateForm")}))}}]).directive("dateField",["moment",function(i){return{require:"ngModel",link:function(e,t,n,o){o.$parsers.push(function(e){return i(e).format("YYYY-MM-DD")}),o.$formatters.push(function(e){return e?i(e).format("l"):""})}}}]).config(["$stateProvider",function(t){_.each(["scheduler.create_booking.client","scheduler.create_booking.deep_service.client","scheduler.create_booking.deep_service.deep_bookable.client","scheduler.create_booking.deep_bookable.client","scheduler.create_booking.deep_bookable.deep_service.client"],function(e){t.state(e,{templateUrl:"src/views/create_booking/client/view.html",controller:"ClientCtrl",resolve:{googleMaps:["organization","booking","angularLoad","settings",function(e,t,n,o){if(_.findWhere(e.$fieldsByService(t.service),{kind:"AddressField"}))return n.loadScript("https://maps.googleapis.com/maps/api/js?key="+o.GOOGLE_PLACES_API_KEY+"&libraries=places")}]},onEnter:["Timers","Mixpanel",function(e,t){e.start("populateForm"),t.trackEvent("Form Loaded")}]})})}]).directive("ngName",["$compile","$parse",function(o,i){return{restrict:"A",terminal:!0,priority:1e5,link:function(e,t){var n=i(t.attr("ng-name"))(e);t.removeAttr("ng-name"),t.attr("name",n),o(t)(e)}}}])}(),function(){"use strict";angular.module("appointlet.scheduler").service("PaymentHandlers",function(){this.handlers={},this.set=function(e,t){this.handlers[e]=t},this.get=function(e){return this.handlers[e]}}).controller("PaymentsCtrl",["$scope","$log","$q","$timeout","PaymentHandlers","Timers","Mixpanel",function(i,t,n,r,a,c,l){var e=_.map(i.organization.payment_accounts,function(t){var e=a.get(t.platform.id);return t.$description=e.description(i.booking.service),t.$prepareData[i.booking.service.id]?n(function(e){e()}):e.prepare(t,i.booking.service.id).then(function(e){t.$prepareData[i.booking.service.id]=e})});i.loading=!0,n.all(e).then(function(){i.loading=!1}),i.select=function(o){return t.debug("PaymentsCtrl","select",o),i.paying=!0,n(function(e,t){if(l.trackEvent("Selected Payment",{Platform:o?o.platform.name:"No Payment",Account:o?o.id:null}),null===o)return e(null);var n=a.get(o.platform.id).authorize(o,o.$prepareData[i.booking.service.id],{amount:i.booking.service.$chargeAmount,currency:i.booking.service.currency},i.booking);i.cancel=function(){return l.trackEvent("Cancelled Payment",{Platform:o.platform.name,Account:o.id}),t()},n.$check&&(i.check=function(){return i.checkStatus="checking",l.trackEvent("Checked Payment",{Platform:o.platform.name,Account:o.id}),n.$check().then(e).catch(function(){i.checkStatus="checked",r(function(){i.checkStatus=void 0},5e3)})}),n.then(e,t)}).finally(function(){i.paying=!1,i.cancel=void 0,i.check=void 0}).then(function(e){return t.debug("PaymentsCtrl","paid",e),l.trackEvent("Completed Payment",{Platform:o?o.platform.name:"No Payment",Account:o?o.id:null,Elapsed:c.stop("createdPayment")}),e&&(i.booking.payment_account=o.id,i.booking.payment_identifier=e),i.createBooking()})},i.isValid=function(){return!!i.booking.payment_account&&!!i.booking.payment_identifier||"optional"===i.organization.payments}}]).config(["$stateProvider",function(t){_.each(["scheduler.create_booking.payment","scheduler.create_booking.deep_service.payment","scheduler.create_booking.deep_service.deep_bookable.payment","scheduler.create_booking.deep_bookable.payment","scheduler.create_booking.deep_bookable.deep_service.payment"],function(e){t.state(e,{templateUrl:"src/views/create_booking/payment/view.html",controller:"PaymentsCtrl",onEnter:["Timers","Mixpanel",function(e,t){e.start("createdPayment"),t.trackEvent("Payment Loaded")}]})})}])}(),function(){"use strict";angular.module("appointlet.scheduler").controller("ReviewCtrl",["$scope","$log","Timers","Mixpanel",function(e,t,n,o){var i=e.booking.service;e.confirmation_action=i.manual_confirm?"Request":"Confirm",e.submit=function(){if(t.debug("ReviewCtrl","submit"),o.trackEvent("Submitted Review",{Elapsed:n.stop("submitReview")}),e.slideManager.getNext())return e.slideManager.goNext();e.createBooking()}}]).config(["$stateProvider",function(t){_.each(["scheduler.create_booking.review","scheduler.create_booking.deep_service.review","scheduler.create_booking.deep_service.deep_bookable.review","scheduler.create_booking.deep_bookable.review","scheduler.create_booking.deep_bookable.deep_service.review"],function(e){t.state(e,{templateUrl:"src/views/create_booking/review/view.html",controller:"ReviewCtrl",onEnter:["Timers","Mixpanel",function(e,t){e.start("submitReview"),t.trackEvent("Review Loaded")}]})})}])}(),function(){"use strict";angular.module("appointlet.scheduler").controller("ServicesCtrl",["$scope","$log","Mixpanel","Timers",function(t,n,o,i){t.deepBookable?(t.services=t.organization.$servicesByBookable(t.booking.bookable),n.debug("ServicesCtrl","noticed deep bookable",t.services)):t.services=_.filter(t.organization.$allowedServices,function(e){return 0<=_.indexOf(t.organization.$servicesPerformed(),e.id)}),t.organization.plan.private_services&&(t.services=_.where(t.services,{visible:!0})),t.select=function(e){n.debug("ServicesCtrl","selected",e),t.booking.service=e,t.slideManager.display("bookables",!t.organization.$canPoolAvailability(e)),t.slideManager.goNext(),o.trackEvent("Selected Service",{"Service ID":e.id,"Service Name":e.name,Elapsed:i.stop("selectService")})},t.isSelected=function(e){return t.booking.service===e},t.isValid=function(){return 0<=_.indexOf(t.services,t.booking.service)}}]).config(["$stateProvider",function(t){_.each(["scheduler.create_booking.services","scheduler.create_booking.deep_bookable.services"],function(e){t.state(e,{templateUrl:"src/views/create_booking/services/view.html",controller:"ServicesCtrl",onEnter:["Timers",function(e){e.start("selectService")}]})})}])}(),function(){"use strict";angular.module("appointlet.scheduler").constant("pooledDistributionServices",[71558,71561,71564,59922,56969,71295,59079,56965,56966,56972,56971,56970,64784,71674,70711,70709,62866,56932,56930,74680,63040,59119,59117,56934,56933,62863,56920,56919,56965,59079,56923,56970,99441,56893,59223,59222,56936,125713,125714]).factory("usesPooledDistribution",["Params","pooledDistributionServices",function(t,n){return function(e){return!_.isUndefined(t.query.pooled_distribution)||-1<_.indexOf(n,e)}}]).controller("TimesCtrl",["$scope","$log","Mixpanel","Timers","Params","usesPooledDistribution",function(o,i,t,r,e,n){var a,c=o.organization.$canPoolAvailability(o.booking.service),l=n(o.booking.service.id);i.debug("TimesCtrl","pooledDistribution",l),c&&!o.deepBookable?(a=o.organization.$bookablesByService(o.booking.service),l?o.bookables=o.organization.$poolInfoV2(o.booking.service.id).then(function(e){return _.chain(e).map(function(e){return _.findWhere(a,{id:e.bookable_id})}).value().slice(0,Math.ceil(e.length/2))}):(o.bookables=a,o.organization.features.calendar_sync||(i.debug("TimesCtrl","pruning pool to 25"),o.bookables=_.shuffle(a).slice(-25)),o.organization.$poolInfo(o.booking.service.id))):o.bookables=[o.booking.bookable],o.parent.modal&&(o.pageSize=6),o.onlyTimesAfter=e.query.only_times_after,o.onlyTimesBefore=e.query.only_times_before,o.$watch("booking.time",function(n,e){n&&n!==e&&(i.debug("TimesCtrl","selected",n),o.booking.start=n.start,o.booking.end=n.end,c&&!o.deepBookable&&(l?o.bookables.then(function(e){var t=_.pluck(n.bookables,"id");o.booking.bookable=_.find(e,function(e){return-1<_.indexOf(t,e.id)}),i.debug("TimesCtrl","picked bookable",o.booking.bookable,"from",n.bookables)}):o.organization.$poolInfo(o.booking.service.id).then(function(t){o.booking.bookable=_.min(n.bookables,function(e){e=_.findWhere(t,{bookable_id:e.id});return e?e.last_booking_id:Math.random()}),i.debug("TimesCtrl","picked bookable",o.booking.bookable,"from",n.bookables)})),o.slideManager.goNext(),t.trackEvent("Selected Time",{Start:o.booking.start.format(),End:o.booking.end.format(),Elapsed:r.stop("selectTime")}))})}]).config(["$stateProvider",function(t){_.each(["scheduler.create_booking.times","scheduler.create_booking.deep_service.times","scheduler.create_booking.deep_service.deep_bookable.times","scheduler.create_booking.deep_bookable.times","scheduler.create_booking.deep_bookable.deep_service.times"],function(e){t.state(e,{templateUrl:"src/views/create_booking/times/view.html",controller:"TimesCtrl",onEnter:["Timers","Mixpanel",function(e,t){e.start("selectTime");e={};try{e=Intl.DateTimeFormat().resolvedOptions()}catch(e){}t.trackEvent("Times Loaded",{IntlTimezone:e.timeZone,IntlLocale:e.locale})}]})})}])}(),function(){"use strict";angular.module("appointlet.scheduler").controller("CreateBookingCtrl",["$scope","$state","$log","$timeout","$window","$q","SlideManager","Parent","Params","BookingsFactory","Mixpanel","Localize","TimePickerCache","booking",function(n,o,i,e,r,a,t,c,l,s,u,d,p,g){i.debug("CreateBookingCtrl","loaded",g),n.booking=g,(n.slideManager=t).slides=[{show:!0,route:"services",label:n.organization.service_type_plural},{show:!0,route:"bookables",label:n.organization.bookable_type_plural},{show:!0,route:"times",label:d.translate("Times")},{show:!0,route:"client",label:d.translate("Information")},{show:!0,route:"review",label:d.translate("Review")},{show:!1,route:"payment",label:d.translate("Payment")}],n.jumpBack=function(e){n.slideManager.isBehind(e.route)&&(o.go("^."+e.route,{},{location:!1}),u.trackEvent("Went Back",{Screen:e.route}))},1===n.organization.$allowedBookables.length&&(i.debug("CreateBookingCtrl","found one bookable, skipping"),n.slideManager.remove("bookables"),n.booking.bookable=n.organization.$allowedBookables[0]),1===n.organization.$allowedServices.length&&(i.debug("CreateBookingCtrl","found one service, skipping"),n.slideManager.remove("services"),n.booking.service=n.organization.$allowedServices[0]),_.every(n.organization.$allowedServices,function(e){return n.organization.$canPoolAvailability(e)})&&n.slideManager.remove("bookables"),n.organization.plan.payments?n.organization.payment_accounts.length&&(_.every(n.organization.$allowedServices,function(e){return 0<e.price&&!e.manual_confirm})?n.slideManager.display("payment",!0):n.$watch("booking.service",function(e){n.slideManager.display("payment",!(!e||!e.price||e.manual_confirm))})):n.slideManager.remove("payment"),l.query.skip_fields&&n.slideManager.remove("client"),n.organization.plan&&e(function(){o.go("."+_.findWhere(n.slideManager.slides,{show:!0}).route,{},{location:!1})}),n.createBooking=function(){return i.debug("CreateBookingCtrl","creating",n.booking),n.creating=!0,s.post(n.booking).then(function(e){var t;return n.createdBooking=e,c.bookingCreated(e),u.trackEvent("Completed Booking",{"Service ID":e.service.id,Service:e.service.name,"Bookable ID":e.bookable.id,Bookable:e.bookable.name,Start:e.start,End:e.end}),n.$broadcast("booking:completed",e),n.organization.redirect_url&&n.organization.plan.redirect?(t=n.organization.$redirectURL(e),c.modal?c.redirect(t):r.location=t,a(function(){})):o.go("^.complete",{bookingID:e.id},{location:!1})}).catch(function(e){i.error("CreateBookingCtrl","failed to create booking",arguments),400===e.status&&_.each(e.data,function(e,t){i.debug("CreateBookingCtrl","error",t,e),"start"===t&&(alert(d.translate("Sorry that time is no longer available.  Please choose another.")),p.clear(),n.jumpBack(n.slideManager.getByRoute("times")))})}).finally(function(){n.creating=!1})},n.bookAnother=function(){r.location.reload()}}]).config(["$stateProvider",function(e){e.state("scheduler.create_booking",{url:"/",templateUrl:"src/views/create_booking/view.html",controller:"CreateBookingCtrl",onEnter:["$rootScope","organization",function(e,t){e.setTitle("New Booking",t.name)}],resolve:{booking:["$state","Params","organization","Storage",function(e,o,i,r){var t,n;return i.plan?(t=r.get("email"),i.plan.prepopulation&&(t=o.query.email||t),n={},i.plan.utm_tracking&&(n.utm_source=o.query.utm_source?o.query.utm_source.substr(0,64):null,n.utm_medium=o.query.utm_medium?o.query.utm_medium.substr(0,64):null,n.utm_campaign=o.query.utm_campaign?o.query.utm_campaign.substr(0,64):null,n.utm_content=o.query.utm_content?o.query.utm_content.substr(0,64):null,n.utm_term=o.query.utm_term?o.query.utm_term.substr(0,64):null),{organization:i,token:o.query.token,timezone:o.query.timezone||i.default_timezone,email:t,utm_source:n.utm_source,utm_medium:n.utm_medium,utm_campaign:n.utm_campaign,utm_content:n.utm_content,utm_term:n.utm_term,fields:_.chain(i.fields).map(function(e){var t="field__"+e.slug,n=r.get(t);return i.plan.prepopulation&&(n=o.query[t]||n),"MultipleChoiceField"===e.kind&&n&&n.length&&(n=_.intersection(n,e.kwargs.choices)),(n="BooleanField"===e.kind?n&&!0:n)?[e.slug,n]:null}).compact().object().value()}):e.go("scheduler.unavailable",{},{location:!1})}]}})}])}(),function(){"use strict";angular.module("appointlet.scheduler").controller("BookableDeepLinkCtrl",["$scope","bookable",function(e,t){e.booking.bookable=t,e.slideManager.remove("bookables"),e.deepBookable=!0}]).config(["$stateProvider",function(e){e.state("scheduler.create_booking.deep_bookable",{url:"b/{bookableSlug}",template:"<div ui-view></div>",controller:"BookableDeepLinkCtrl",resolve:{bookable:["$stateParams","Collection","organization",function(e,t,n){var o=_.findWhere(n.$allowedBookables,{slug:e.bookableSlug});return angular.isDefined(o)?o:t.getObjectOrDie(n.$allowedBookables,{id:+e.bookableSlug})}]}}).state("scheduler.create_booking.deep_service.deep_bookable",{url:"/{bookableSlug}",template:"<div ui-view></div>",controller:"BookableDeepLinkCtrl",resolve:{bookable:["$stateParams","Collection","organization",function(e,t,n){var o=_.findWhere(n.$allowedBookables,{slug:e.bookableSlug});return angular.isDefined(o)?o:t.getObjectOrDie(n.$allowedBookables,{id:+e.bookableSlug})}]}})}])}(),function(){"use strict";angular.module("appointlet.scheduler").controller("ServiceDeepLinkCtrl",["$scope","service",function(e,t){e.booking.service=t,e.slideManager.remove("services"),e.deepService=!0,e.organization.$canPoolAvailability(e.booking.service)&&e.slideManager.remove("bookables")}]).config(["$stateProvider",function(e){e.state("scheduler.create_booking.deep_service",{url:"s/{serviceSlug}",template:"<div ui-view></div>",controller:"ServiceDeepLinkCtrl",resolve:{service:["$stateParams","Collection","organization",function(e,t,n){var o=_.findWhere(n.$allowedServices,{slug:e.serviceSlug});return angular.isDefined(o)?o:t.getObjectOrDie(n.$allowedServices,{id:+e.serviceSlug})}]}}).state("scheduler.create_booking.deep_bookable.deep_service",{url:"/{serviceSlug}",template:"<div ui-view></div>",controller:"ServiceDeepLinkCtrl",resolve:{service:["$stateParams","Collection","organization",function(e,t,n){var o=_.findWhere(n.$allowedServices,{slug:e.serviceSlug});return angular.isDefined(o)?o:t.getObjectOrDie(n.$allowedServices,{id:+e.serviceSlug})}]}})}])}(),function(){"use strict";angular.module("appointlet.scheduler").config(["$stateProvider",function(e){e.state("scheduler.unavailable",{templateUrl:"src/views/unavailable/view.html",onEnter:["$rootScope","organization",function(e,t){e.setTitle("Unavailable",t.name)}]})}])}(),function(){"use strict";angular.module("appointlet.scheduler").controller("CancelBookingCtrl",["$scope","$state","$log",function(t,n,o){t.cancel=function(e){o.debug("CancelBookingCtrl","canceling",e),t.canceling=!0,t.booking.$cancel(e).then(function(){o.debug("CancelBookingCtrl","canceled",arguments),t.booking.canceled=!0,n.go("^.summary")}).catch(function(){o.error("CancelBookingCtrl","failed",arguments)}).finally(function(){t.canceling=!1})}}]).config(["$stateProvider",function(e){e.state("scheduler.update_booking.cancel",{url:"/cancel",templateUrl:"src/views/update_booking/cancel/view.html",controller:"CancelBookingCtrl"})}])}(),function(){"use strict";angular.module("appointlet.scheduler").controller("RescheduleBookingConfirmCtrl",["$scope","$state","$log",function(o,i,r){o.reschedule=function(e,t,n){r.debug("RescheduleBookingConfirmCtrl","rescheduling",e,t,n),o.rescheduling=!0,o.booking.$reschedule(e,t,n).then(function(){r.debug("RescheduleBookingConfirmCtrl","rescheduled"),o.booking.start=e,o.booking.end=t,i.go("scheduler.update_booking.summary")}).catch(function(){r.debug("RescheduleBookingConfirmCtrl","failed",arguments)}).finally(function(){o.rescheduling=!1})}}]).config(["$stateProvider",function(e){e.state("scheduler.update_booking.reschedule.confirm",{templateUrl:"src/views/update_booking/reschedule/confirm/view.html",controller:"RescheduleBookingConfirmCtrl"})}])}(),function(){"use strict";angular.module("appointlet.scheduler").controller("RescheduleBookingCtrl",function(){}).config(["$stateProvider",function(e){e.state("scheduler.update_booking.reschedule",{url:"/reschedule",templateUrl:"src/views/update_booking/reschedule/view.html",controller:"RescheduleBookingCtrl"})}])}(),function(){"use strict";angular.module("appointlet.scheduler").controller("UpdateBookingSummaryCtrl",function(){}).config(["$stateProvider",function(e){e.state("scheduler.update_booking.summary",{url:"",templateUrl:"src/views/update_booking/summary/view.html",controller:"UpdateBookingSummaryCtrl",onEnter:["$rootScope","booking","organization",function(e,t,n){e.setTitle(t.service.name,n.name)}]})}])}(),function(){"use strict";angular.module("appointlet.scheduler").controller("UpdateBookingCtrl",["$scope","$state","$log","$interval","booking","moment",function(n,e,t,o,i,r){n.booking=i,n.now=r(),o(function(){n.now=r()},1e3);function a(e){var t=i.start.clone().subtract(e);return null!==e&&n.now.isBefore(t)}n.isCancelable=function(){return!n.booking.canceled&&!n.hasEnded()&&a(i.service.cancelation_notice)},n.isReschedulable=function(){return!n.booking.canceled&&!n.hasEnded()&&a(i.service.reschedule_notice)},n.hasEnded=function(){return n.now.isAfter(i.start)}}]).config(["$stateProvider",function(e){e.state("scheduler.update_booking",{abstract:!0,url:"/booking/{bookingID}",template:"<div ui-view></div>",controller:"UpdateBookingCtrl",resolve:{booking:["$stateParams","BookingsFactory","Bookables","Services","moment",function(e,t,n,o,i){return t.one(e.bookingID).get().then(function(e){return e.start=i(e.start),e.end=i(e.end),o.augment(e.service),n.augment(e.bookable),e})}]}})}])}(),function(){"use strict";angular.module("appointlet.scheduler").controller("SchedulerCtrl",["$scope","$timeout","Mixpanel","organization","settings","QueryString",function(e,t,n,o,i,r){(e.organization=o).display_branding&&t(function(){e.logo={show:!0,url:i.WWW_URL+"/?"+r.encode({utm_campaign:"branding",utm_medium:"bpage",utm_source:o.slug}),completedUrl:i.WWW_URL+"/?"+r.encode({utm_campaign:"branding",utm_medium:"completed",utm_source:o.slug,utm_content:"bot-gf"})}}),n.register({"Organization ID":o.id,"Organization Name":o.name,"Organization Services Count":o.services.length,"Organization Bookables Count":o.bookables.length,"Organization Fields Count":o.fields.length,"Organization Payment Accounts Count":o.payment_accounts.length})}]).config(["$stateProvider",function(e){e.state("scheduler",{abstract:!0,templateUrl:"src/views/view.html",controller:"SchedulerCtrl",resolve:{organization:"Organization"}})}])}();
//# sourceMappingURL=logic.min.js.map